# Local File Inclusion (LFI)

### Summary
ZEIT Next.js before 5.1.0 are vulnerable to local file inclusion, meaning if an attacker is able to host a JavaScript file anywhere on the server file system he could execute arbitrary JavaScript on the server.

The vulnerable route is `/:path*`, it triggre the following chain, passing an attacker controlled path leading to exploitation.

`defineRoutes()->render()->renderToHTML()->renderToHTML()->doRender()->requireModule()`

### Proof of concept
Build and run our vulnerable application
```
docker build . -t next_js_lfi
docker run --rm -it -p 3000:3000 next_js_lfi
```

Run the exploit
```
node ./exploit.js
```

Expected server output
```
> Ready on http://localhost:3000
Code Execution!
let's kill the server now...
```

### Fix
The vulnerability was fixed at version 5.1.0 (A)

### Refrences
A. https://github.com/zeit/next.js/blob/a29a8fe10ae194646dfb4b337298d6972cef9742/packages/next-server/server/require.js#L9