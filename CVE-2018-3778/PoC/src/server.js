"use strict";

const net = require("net");
const aedes = require("aedes");

const authorizePublish = function (a, b, c) {
    console.log("Reject all packet!");
    c(new Error("Not allowed"));
};

const aedesProtocol = aedes({ authorizePublish });

aedesProtocol.on("client", function () {
    console.log("client connected!");
});

aedesProtocol.on("clientDisconnect", function () {
    console.log("client disconnected!");
});

// Handle incoming packets on the "test" topic
aedesProtocol.mq.on("test", function (packet, cb) {
    console.log("got message->", packet.payload.toString("utf8"));
    cb();
});

net.createServer(aedesProtocol.handle).listen(1883);