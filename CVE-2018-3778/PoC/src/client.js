"use strict";

const net = require("net");
const mqttPacket = require("mqtt-packet");

const stream = net.createConnection(1883, "localhost");

function connect() {
    stream.write(mqttPacket.generate({
        cmd: "connect",
        protocolId: "MQTT",
        protocolVersion: 4,
        clean: true,
        clientId: "my-device",
        keepalive: 0,
        will: {
            topic: "test",
            payload: Buffer.from("will!")
        }
    }));
}

function publish(topic, payload) {
    stream.write(mqttPacket.generate({
        topic,
        cmd: "publish",
        qos: 0,
        messageId: 0,
        payload: Buffer.from(payload)
    }));
}

function main() {
    connect();
    publish("test", "Hello World!");
}

main();