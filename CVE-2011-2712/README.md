## CVE-2012-3373

### Introduction
Apache Wicket is a component-based web application framework for the Java programming language.
CVE-2012-3373 refers to a cross-site scripting vulnerability affecting the version period to 1.4.21.

### The Vulnerability
The vulnerability was in the `RequestCycle.java` file, spesificlly in the `encodeUrlFor` method.

```java
private final CharSequence encodeUrlFor(final IRequestTarget requestTarget)
{
    CharSequence url = getProcessor().getRequestCodingStrategy().encode(this, requestTarget);
    urlForNewWindowEncoding = false;
    return url;
}
```
This method is vulnerable to null byte injection, my assumption is that it will only encode the URL up to the null byte, allowing attackers to use dangers characters like `'"<>`.

This method is called by the public `urlFor` method used by `AjaxFormChoiceComponentUpdatingBehavior.java:151`

```java
protected final CharSequence getEventHandler()
{
	return generateCallbackScript(new AppendingStringBuffer("wicketAjaxPost('").append(
		getCallbackUrl()).append(
		"', wicketSerializeForm(document.getElementById('" + getComponent().getMarkupId() +
			"',false))"));
}
```

As you can see above, the method builds a JavaScript code that will later be injected into the page.
The method `getCallbackUrl` is used for getting the current request URL, which is later passed on to the `urlFor` method I've mentioned above.

### The Fix

The method was fixed by checking if the URL contains a null byte, in case it does, it will remove it and everything after it. (see A)

```java
private final CharSequence encodeUrlFor(final IRequestTarget requestTarget)
{
    CharSequence url = getProcessor().getRequestCodingStrategy().encode(this, requestTarget);
    url = JavascriptUtils.escapeQuotes(url);
    url = cutNilChar(url);
    urlForNewWindowEncoding = false;
    return url;
}
```

### Refrences
A. https://github.com/apache/wicket/commit/d841a285b21bef9ba8f8bacead7bda862465df8d